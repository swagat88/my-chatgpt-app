<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ChatGPT Plus Deep Search</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat { width: 100%; max-width: 600px; margin: auto; }
    #messages { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto; margin-bottom: 10px; }
    #input-area { display: flex; }
    #query { flex: 1; padding: 10px; }
    #send { padding: 10px; }
  </style>
</head>
<body>
  <div id="chat">
    <h1>ChatGPT Plus Deep Search</h1>
    <div>
      <label>
        Deep Search Mode:
        <input type="checkbox" id="deepSearch">
      </label>
      <br>
      <label>
        Price Limit per Query ($): 
        <input type="number" id="priceLimit" value="5" step="0.1" min="0">
      </label>
    </div>
    <div id="messages"></div>
    <div id="input-area">
      <input type="text" id="query" placeholder="Type your message here...">
      <button id="send">Send</button>
    </div>
  </div>
  <script>
    const messagesDiv = document.getElementById('messages');
    const queryInput = document.getElementById('query');
    const deepSearchCheckbox = document.getElementById('deepSearch');
    const priceLimitInput = document.getElementById('priceLimit');
    const sendButton = document.getElementById('send');
    
    function appendMessage(text, from = 'user') {
      const msg = document.createElement('div');
      msg.textContent = (from === 'user' ? 'You: ' : 'ChatGPT: ') + text;
      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }
    
    sendButton.addEventListener('click', async () => {
      const query = queryInput.value;
      if (!query) return;
      const deepSearch = deepSearchCheckbox.checked;
      const priceLimit = parseFloat(priceLimitInput.value) || 5;
      
      appendMessage(query, 'user');
      queryInput.value = '';
      
      try {
        const res = await fetch('/.netlify/functions/chatgpt', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query, deepSearch, priceLimit })
        });
        const data = await res.json();
        if(data.error) {
          appendMessage("Error: " + data.error, 'chatgpt');
        } else {
          appendMessage(data.response, 'chatgpt');
          if(data.chargeInfo) {
            appendMessage("Charge Info: " + data.chargeInfo, 'chatgpt');
          }
        }
      } catch (err) {
        appendMessage("Error: " + err.message, 'chatgpt');
      }
    });
  </script>
</body>
</html>
